<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GZFCYV0DXN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GZFCYV0DXN",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Pathom 3" href="/opensearch.xml"><title data-react-helmet="true">Resolvers | Pathom 3</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Resolvers | Pathom 3"><meta data-react-helmet="true" name="description" content="Resolvers are the primary building blocks in Pathom. They are the constructs to express"><meta data-react-helmet="true" property="og:description" content="Resolvers are the primary building blocks in Pathom. They are the constructs to express"><meta data-react-helmet="true" property="og:url" content="https://pathom3.wsscode.com/docs/resolvers"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://pathom3.wsscode.com/docs/resolvers"><link rel="stylesheet" href="/styles.98692c14.css">
<link rel="preload" href="/styles.bef5ab94.js" as="script">
<link rel="preload" href="/runtime~main.3f4d5e33.js" as="script">
<link rel="preload" href="/main.247d77bb.js" as="script">
<link rel="preload" href="/1.0c39851d.js" as="script">
<link rel="preload" href="/2.355056da.js" as="script">
<link rel="preload" href="/3.3cf39f4a.js" as="script">
<link rel="preload" href="/1be78505.b7b1ed05.js" as="script">
<link rel="preload" href="/38.e3a94f3c.js" as="script">
<link rel="preload" href="/935f2afb.0045dded.js" as="script">
<link rel="preload" href="/17896441.6b25e3fd.js" as="script">
<link rel="preload" href="/c9b331de.a7b258c4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a class="navbar__item navbar__link" href="/media">Media</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon_64x64.png" alt="Pathom 3"><strong class="navbar__title">Pathom 3</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://blog.wsscode.com" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/media">Media</a></li><li class="menu__list-item"><a href="https://github.com/wilkerlucio/pathom3" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial">Pathom Tutorial</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Using Pathom</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/resolvers">Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/built-in-resolvers">Built-in Resolvers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/smart-maps">Smart Maps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/eql">EQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment">Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cache">Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/placeholders">Placeholders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mutations">Mutations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugins">Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/async">Async</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How Pathom Works</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexes">Indexes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/planner">Planner</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shape-descriptor">Shape Descriptor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/hacker-news-scraper">Hacker News Scraper</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Resolvers</h1></header><div class="markdown"><p>Resolvers are the primary building blocks in Pathom. They are the constructs to express
relationships between attributes.</p><p>On this page, you will learn how to create resolvers and use them. After that you
will learn about the built-in resolvers that come with Pathom.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-is-a-resolver-in-pathom"></a>What is a resolver in Pathom?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-resolver-in-pathom" title="Direct link to heading">#</a></h2><p>The Pathom engine gathers its resolution features from the relationship between attributes.
Resolvers are the piece that expresses those relationships.</p><p>To put in more concrete terms, imagine that you have some user id, and you want to know
the user&#x27;s birth year. In Pathom, we express this relationship using the attributes
<code>:acme.user/id</code> and <code>:acme.user/birth-year</code> for example.</p><p>Now we need to implement how to fetch the name from the id, this can be a lookup in a
database, or a map, or any other way, doesn&#x27;t matter. What matters is that you express
this connection and provide code that makes it happen.</p><p>Here I&#x27;ll illustrate this using a map lookup:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def user-birthdays</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {1 1969</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   2 1954</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   3 1986})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; defresolver is the main option to create new resolvers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-birthday [{:keys [acme.user/id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.user/birth-year (get user-birthdays id)})</span></div></div></div></div></div><p>In Pathom, resolvers represent edges in a graph. As illustrated in the following figure:</p><div class="pathom-diagram"><p>  <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM6eGw9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHZpZXdCb3g9IjYxNSAzNzggNTIzIDE1OSIgd2lkdGg9IjUyMyIgaGVpZ2h0PSIxNTkiPgogIDxkZWZzPgogICAgPGZpbHRlciBpZD0iU2hhZG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjU2Mi43IiB5PSIzNjIuMSI+CiAgICAgIDxmZUdhdXNzaWFuQmx1ciBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0iYmx1ciIgc3RkRGV2aWF0aW9uPSIxLjMwOCIvPgogICAgICA8ZmVPZmZzZXQgaW49ImJsdXIiIHJlc3VsdD0ib2Zmc2V0IiBkeD0iMSIgZHk9IjMiLz4KICAgICAgPGZlRmxvb2QgZmxvb2QtY29sb3I9ImJsYWNrIiBmbG9vZC1vcGFjaXR5PSIuNSIgcmVzdWx0PSJmbG9vZCIvPgogICAgICA8ZmVDb21wb3NpdGUgaW49ImZsb29kIiBpbjI9Im9mZnNldCIgb3BlcmF0b3I9ImluIiByZXN1bHQ9ImNvbG9yIi8+CiAgICAgIDxmZU1lcmdlPgogICAgICAgIDxmZU1lcmdlTm9kZSBpbj0iY29sb3IiLz4KICAgICAgICA8ZmVNZXJnZU5vZGUgaW49IlNvdXJjZUdyYXBoaWMiLz4KICAgICAgPC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgICA8Zm9udC1mYWNlIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgcGFub3NlLTE9IjIgMCA1IDMgMCAwIDAgMiAwIDQiIHVuaXRzLXBlci1lbT0iMTAwMCIgdW5kZXJsaW5lLXBvc2l0aW9uPSItMTAwIiB1bmRlcmxpbmUtdGhpY2tuZXNzPSI1MCIgc2xvcGU9IjAiIHgtaGVpZ2h0PSI1MTciIGNhcC1oZWlnaHQ9IjcxNCIgYXNjZW50PSI5NTEuOTk1OCIgZGVzY2VudD0iLTIxMi45OTc0NCIgZm9udC13ZWlnaHQ9IjQwMCI+CiAgICAgIDxmb250LWZhY2Utc3JjPgogICAgICAgIDxmb250LWZhY2UtbmFtZSBuYW1lPSJIZWx2ZXRpY2FOZXVlIi8+CiAgICAgIDwvZm9udC1mYWNlLXNyYz4KICAgIDwvZm9udC1mYWNlPgogICAgPG1hcmtlciBvcmllbnQ9ImF1dG8iIG92ZXJmbG93PSJ2aXNpYmxlIiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIGlkPSJGaWxsZWRBcnJvd19NYXJrZXIiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgdmlld0JveD0iLTEgLTMgNyA2IiBtYXJrZXJXaWR0aD0iNyIgbWFya2VySGVpZ2h0PSI2IiBjb2xvcj0id2hpdGUiPgogICAgICA8Zz4KICAgICAgICA8cGF0aCBkPSJNIDQuOCAwIEwgMCAtMS44IEwgMCAxLjggWiIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICAgIDwvZz4KICAgIDwvbWFya2VyPgogIDwvZGVmcz4KICA8bWV0YWRhdGE+IFByb2R1Y2VkIGJ5IE9tbmlHcmFmZmxlIDcuMTcuNVxuMjAyMC0xMC0wNSAyMDo0NTowNiArMDAwMDwvbWV0YWRhdGE+CiAgPGcgaWQ9IkNhbnZhc18xIiBmaWxsPSJub25lIiBzdHJva2Utb3BhY2l0eT0iMSIgZmlsbC1vcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiIHN0cm9rZS1kYXNoYXJyYXk9Im5vbmUiPgogICAgPHRpdGxlPkNhbnZhcyAxPC90aXRsZT4KICAgIDxnIGlkPSJDYW52YXNfMV9MYXllcl8xIj4KICAgICAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogICAgICA8ZyBpZD0iR3JhcGhpY180IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGNpcmNsZSBjeD0iNjkzIiBjeT0iNDU0LjUiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIGZpbGw9IiNmZmZmYzAiLz4KICAgICAgICA8Y2lyY2xlIGN4PSI2OTMiIGN5PSI0NTQuNSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgc3Ryb2tlPSIjZjBmM2Y2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDYzOCA0NDUuMjc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjMwLjQwOCIgeT0iMTUiPnVzZXIvaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY181IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGNpcmNsZSBjeD0iMTA1Ny41IiBjeT0iNDU0LjUiIHI9Ijc1LjAwMDExOTg0MjY0MjEiIGZpbGw9IiNmZmZmYzAiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxMDU3LjUiIGN5PSI0NTQuNSIgcj0iNzUuMDAwMTE5ODQyNjQyMSIgc3Ryb2tlPSIjZjBmM2Y2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMDIuNSA0NDUuMjc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjIuNDA4IiB5PSIxNSI+dXNlci9iaXJ0aC15ZWFyPC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkxpbmVfNiIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxsaW5lIHgxPSI3NjkiIHkxPSI0NTQuNSIgeDI9Ijk2OC42IiB5Mj0iNDU0LjUiIG1hcmtlci1lbmQ9InVybCgjRmlsbGVkQXJyb3dfTWFya2VyKSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY183IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPHJlY3QgeD0iODE1Ljg0ODciIHk9IjQ0MC4yNzYiIHdpZHRoPSIxMDQuNTQ0IiBoZWlnaHQ9IjI4LjQ0Nzk5OCIgZmlsbD0iI2MwYzBmZiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDgyMC44NDg3IDQ0NS4yNzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iODQ1NTQ1OWUtMTkiIHk9IjE1Ij51c2VyLWJpcnRoZGF5PC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="></p></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>I made the names short on the diagrams for space, but keep your domain qualifiers long.</p></div></div><p>This example was a simplification; most systems will store the full birth date instead,
and then extract the year from this date.</p><p>We can simulate such case using the following setup:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; define a map for indexed access to user data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def users-db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {1 #:acme.user{:name     &quot;Usuario 1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 :email    &quot;user@provider.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 :birthday &quot;1989-10-25&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   2 #:acme.user{:name     &quot;Usuario 2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 :email    &quot;anuser@provider.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 :birthday &quot;1975-09-11&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; pull stored user info from id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-by-id [{:keys [acme.user/id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [:acme.user/name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    :acme.user/email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    :acme.user/birthday]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (get users-db id))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; extract birth year from birthday</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver birth-year [{:keys [acme.user/birthday]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.user/birth-year (first (str/split birthday #&quot;-&quot;))})</span></div></div></div></div></div><p>Here is a diagram from the previous setup:</p><div class="pathom-diagram"><p>  <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM6eGw9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHZpZXdCb3g9IjM2MCA2MjUgODA1IDU2NiIgd2lkdGg9IjgwNSIgaGVpZ2h0PSI1NjYiPgogIDxkZWZzPgogICAgPGZpbHRlciBpZD0iU2hhZG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjI3OS41IiB5PSI1NjguNCI+CiAgICAgIDxmZUdhdXNzaWFuQmx1ciBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0iYmx1ciIgc3RkRGV2aWF0aW9uPSIxLjMwOCIvPgogICAgICA8ZmVPZmZzZXQgaW49ImJsdXIiIHJlc3VsdD0ib2Zmc2V0IiBkeD0iMSIgZHk9IjMiLz4KICAgICAgPGZlRmxvb2QgZmxvb2QtY29sb3I9ImJsYWNrIiBmbG9vZC1vcGFjaXR5PSIuNSIgcmVzdWx0PSJmbG9vZCIvPgogICAgICA8ZmVDb21wb3NpdGUgaW49ImZsb29kIiBpbjI9Im9mZnNldCIgb3BlcmF0b3I9ImluIiByZXN1bHQ9ImNvbG9yIi8+CiAgICAgIDxmZU1lcmdlPgogICAgICAgIDxmZU1lcmdlTm9kZSBpbj0iY29sb3IiLz4KICAgICAgICA8ZmVNZXJnZU5vZGUgaW49IlNvdXJjZUdyYXBoaWMiLz4KICAgICAgPC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgICA8Zm9udC1mYWNlIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgcGFub3NlLTE9IjIgMCA1IDMgMCAwIDAgMiAwIDQiIHVuaXRzLXBlci1lbT0iMTAwMCIgdW5kZXJsaW5lLXBvc2l0aW9uPSItMTAwIiB1bmRlcmxpbmUtdGhpY2tuZXNzPSI1MCIgc2xvcGU9IjAiIHgtaGVpZ2h0PSI1MTciIGNhcC1oZWlnaHQ9IjcxNCIgYXNjZW50PSI5NTEuOTk1OCIgZGVzY2VudD0iLTIxMi45OTc0NCIgZm9udC13ZWlnaHQ9IjQwMCI+CiAgICAgIDxmb250LWZhY2Utc3JjPgogICAgICAgIDxmb250LWZhY2UtbmFtZSBuYW1lPSJIZWx2ZXRpY2FOZXVlIi8+CiAgICAgIDwvZm9udC1mYWNlLXNyYz4KICAgIDwvZm9udC1mYWNlPgogICAgPG1hcmtlciBvcmllbnQ9ImF1dG8iIG92ZXJmbG93PSJ2aXNpYmxlIiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIGlkPSJGaWxsZWRBcnJvd19NYXJrZXIiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgdmlld0JveD0iLTEgLTMgNyA2IiBtYXJrZXJXaWR0aD0iNyIgbWFya2VySGVpZ2h0PSI2IiBjb2xvcj0id2hpdGUiPgogICAgICA8Zz4KICAgICAgICA8cGF0aCBkPSJNIDQuOCAwIEwgMCAtMS44IEwgMCAxLjggWiIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICAgIDwvZz4KICAgIDwvbWFya2VyPgogIDwvZGVmcz4KICA8bWV0YWRhdGE+IFByb2R1Y2VkIGJ5IE9tbmlHcmFmZmxlIDcuMTcuNVxuMjAyMC0xMC0wNSAyMDo0MzozMyArMDAwMDwvbWV0YWRhdGE+CiAgPGcgaWQ9IkNhbnZhc18yIiBmaWxsPSJub25lIiBzdHJva2Utb3BhY2l0eT0iMSIgZmlsbC1vcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiIHN0cm9rZS1kYXNoYXJyYXk9Im5vbmUiPgogICAgPHRpdGxlPkNhbnZhcyAyPC90aXRsZT4KICAgIDxnIGlkPSJDYW52YXNfMl9MYXllcl8xIj4KICAgICAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogICAgICA8ZyBpZD0iR3JhcGhpY18xNCIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9Ijc0MiIgY3k9IjExMDkiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIGZpbGw9IiNmZmZmYzAiLz4KICAgICAgICA8Y2lyY2xlIGN4PSI3NDIiIGN5PSIxMTA5IiByPSI3NS4wMDAxMTk4NDI2NDIyIiBzdHJva2U9IiNmMGYzZjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjg3IDEwOTkuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjcuNzM2IiB5PSIxNSI+dXNlci9iaXJ0aGRheTwvdHNwYW4+CiAgICAgICAgPC90ZXh0PgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJHcmFwaGljXzEzIiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGNpcmNsZSBjeD0iMTA4NC41IiBjeT0iMTEwOSIgcj0iNzUuMDAwMTE5ODQyNjQyMSIgZmlsbD0iI2ZmZmZjMCIvPgogICAgICAgIDxjaXJjbGUgY3g9IjEwODQuNSIgY3k9IjExMDkiIHI9Ijc1LjAwMDExOTg0MjY0MjEiIHN0cm9rZT0iI2YwZjNmNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMDI5LjUgMTA5OS43NzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMi40MDgiIHk9IjE1Ij51c2VyL2JpcnRoLXllYXI8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iTGluZV8xMiIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxsaW5lIHgxPSI4MTgiIHkxPSIxMTA5IiB4Mj0iOTk1LjYiIHkyPSIxMTA5IiBtYXJrZXItZW5kPSJ1cmwoI0ZpbGxlZEFycm93X01hcmtlcikiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfMTEiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8cmVjdCB4PSI4NTQuMjk4OCIgeT0iMTA5NC43NzYiIHdpZHRoPSIxMDUuMTIiIGhlaWdodD0iMjguNDQ3OTk4IiBmaWxsPSIjYzBjMGZmIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODU5LjI5ODggMTA5OS43NzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMCIgeT0iMTUiPmJpcnRoZGF5LXllYXI8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY18xMCIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9IjQzOC41IiBjeT0iOTA1IiByPSI3NS4wMDAxMTk4NDI2NDIyIiBmaWxsPSIjZmZmZmMwIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iNDM4LjUiIGN5PSI5MDUiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIHN0cm9rZT0iI2YwZjNmNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzODMuNSA4OTUuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjMwLjQwOCIgeT0iMTUiPnVzZXIvaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iTGluZV85IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGxpbmUgeDE9IjUwMS41ODczNCIgeTE9Ijk0Ny40MDQ3IiB4Mj0iNjY4LjIwNjQiIHkyPSIxMDU5LjM5OSIgbWFya2VyLWVuZD0idXJsKCNGaWxsZWRBcnJvd19NYXJrZXIpIiBzdHJva2U9IndoaXRlIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJHcmFwaGljXzgiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8cmVjdCB4PSI1NDIuODQ0OCIgeT0iOTg4Ljc3NzIiIHdpZHRoPSI4Mi45MTIiIGhlaWdodD0iMjguNDQ3OTk4IiBmaWxsPSIjYzBjMGZmIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTQ3Ljg0NDggOTkzLjc3NzIpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMTI3ODk3N2UtMTkiIHk9IjE1Ij51c2VyLWJ5LWlkPC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfNyIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9Ijc0MiIgY3k9IjcwMSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgZmlsbD0iI2ZmZmZjMCIvPgogICAgICAgIDxjaXJjbGUgY3g9Ijc0MiIgY3k9IjcwMSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgc3Ryb2tlPSIjZjBmM2Y2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDY4NyA2OTEuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjE3LjA2NCIgeT0iMTUiPnVzZXIvbmFtZTwvdHNwYW4+CiAgICAgICAgPC90ZXh0PgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJHcmFwaGljXzYiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8Y2lyY2xlIGN4PSI3NDIiIGN5PSI5MDUiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIGZpbGw9IiNmZmZmYzAiLz4KICAgICAgICA8Y2lyY2xlIGN4PSI3NDIiIGN5PSI5MDUiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIHN0cm9rZT0iI2YwZjNmNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2ODcgODk1Ljc3NikiIGZpbGw9ImJsYWNrIj4KICAgICAgICAgIDx0c3BhbiBmb250LWZhbWlseT0iSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI0MDAiIGZpbGw9ImJsYWNrIiB4PSIxNy45NiIgeT0iMTUiPnVzZXIvZW1haWw8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iTGluZV81IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGxpbmUgeDE9IjUxNC41MDAwNCIgeTE9IjkwNSIgeDI9IjY1My4xIiB5Mj0iOTA1IiBtYXJrZXItZW5kPSJ1cmwoI0ZpbGxlZEFycm93X01hcmtlcikiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfNCIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxyZWN0IHg9IjU0My43MTEyIiB5PSI4OTAuNzc2IiB3aWR0aD0iODIuOTEyIiBoZWlnaHQ9IjI4LjQ0Nzk5OCIgZmlsbD0iI2MwYzBmZiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDU0OC43MTEyIDg5NS43NzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMTI3ODk3N2UtMTkiIHk9IjE1Ij51c2VyLWJ5LWlkPC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkxpbmVfMyIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxsaW5lIHgxPSI1MDEuNTg3MzMiIHkxPSI4NjIuNTk1MyIgeDI9IjY2OC4yMDY0IiB5Mj0iNzUwLjYwMDk1IiBtYXJrZXItZW5kPSJ1cmwoI0ZpbGxlZEFycm93X01hcmtlcikiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfMiIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxyZWN0IHg9IjU0Mi44NDQ4IiB5PSI3OTIuNzc0OCIgd2lkdGg9IjgyLjkxMiIgaGVpZ2h0PSIyOC40NDc5OTgiIGZpbGw9IiNjMGMwZmYiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDcuODQ0OCA3OTcuNzc0OCkiIGZpbGw9ImJsYWNrIj4KICAgICAgICAgIDx0c3BhbiBmb250LWZhbWlseT0iSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI0MDAiIGZpbGw9ImJsYWNrIiB4PSIxMjc4OTc3ZS0xOSIgeT0iMTUiPnVzZXItYnktaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg=="></p></div><p>Given that image, let&#x27;s consider that we know about some user id and want to know
this user birthday, we can reach that using the path highlighted in the next diagram:</p><div class="pathom-diagram"><p>  <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM6eGw9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHZpZXdCb3g9IjM2MCA2MjUgODA1IDU2NiIgd2lkdGg9IjgwNSIgaGVpZ2h0PSI1NjYiPgogIDxkZWZzPgogICAgPGZpbHRlciBpZD0iU2hhZG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjI3OS41IiB5PSI1NjguNCI+CiAgICAgIDxmZUdhdXNzaWFuQmx1ciBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0iYmx1ciIgc3RkRGV2aWF0aW9uPSIxLjMwOCIvPgogICAgICA8ZmVPZmZzZXQgaW49ImJsdXIiIHJlc3VsdD0ib2Zmc2V0IiBkeD0iMSIgZHk9IjMiLz4KICAgICAgPGZlRmxvb2QgZmxvb2QtY29sb3I9ImJsYWNrIiBmbG9vZC1vcGFjaXR5PSIuNSIgcmVzdWx0PSJmbG9vZCIvPgogICAgICA8ZmVDb21wb3NpdGUgaW49ImZsb29kIiBpbjI9Im9mZnNldCIgb3BlcmF0b3I9ImluIiByZXN1bHQ9ImNvbG9yIi8+CiAgICAgIDxmZU1lcmdlPgogICAgICAgIDxmZU1lcmdlTm9kZSBpbj0iY29sb3IiLz4KICAgICAgICA8ZmVNZXJnZU5vZGUgaW49IlNvdXJjZUdyYXBoaWMiLz4KICAgICAgPC9mZU1lcmdlPgogICAgPC9maWx0ZXI+CiAgICA8Zm9udC1mYWNlIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgcGFub3NlLTE9IjIgMCA1IDMgMCAwIDAgMiAwIDQiIHVuaXRzLXBlci1lbT0iMTAwMCIgdW5kZXJsaW5lLXBvc2l0aW9uPSItMTAwIiB1bmRlcmxpbmUtdGhpY2tuZXNzPSI1MCIgc2xvcGU9IjAiIHgtaGVpZ2h0PSI1MTciIGNhcC1oZWlnaHQ9IjcxNCIgYXNjZW50PSI5NTEuOTk1OCIgZGVzY2VudD0iLTIxMi45OTc0NCIgZm9udC13ZWlnaHQ9IjQwMCI+CiAgICAgIDxmb250LWZhY2Utc3JjPgogICAgICAgIDxmb250LWZhY2UtbmFtZSBuYW1lPSJIZWx2ZXRpY2FOZXVlIi8+CiAgICAgIDwvZm9udC1mYWNlLXNyYz4KICAgIDwvZm9udC1mYWNlPgogICAgPG1hcmtlciBvcmllbnQ9ImF1dG8iIG92ZXJmbG93PSJ2aXNpYmxlIiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIGlkPSJGaWxsZWRBcnJvd19NYXJrZXIiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgdmlld0JveD0iLTEgLTMgNSA2IiBtYXJrZXJXaWR0aD0iNSIgbWFya2VySGVpZ2h0PSI2IiBjb2xvcj0ibGltZSI+CiAgICAgIDxnPgogICAgICAgIDxwYXRoIGQ9Ik0gMi44OCAwIEwgMCAtMS4wOCBMIDAgMS4wOCBaIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEiLz4KICAgICAgPC9nPgogICAgPC9tYXJrZXI+CiAgICA8bWFya2VyIG9yaWVudD0iYXV0byIgb3ZlcmZsb3c9InZpc2libGUiIG1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgaWQ9IkZpbGxlZEFycm93X01hcmtlcl8yIiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHZpZXdCb3g9Ii0xIC0zIDcgNiIgbWFya2VyV2lkdGg9IjciIG1hcmtlckhlaWdodD0iNiIgY29sb3I9IndoaXRlIj4KICAgICAgPGc+CiAgICAgICAgPHBhdGggZD0iTSA0LjggMCBMIDAgLTEuOCBMIDAgMS44IFoiIGZpbGw9ImN1cnJlbnRDb2xvciIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgICA8L2c+CiAgICA8L21hcmtlcj4KICA8L2RlZnM+CiAgPG1ldGFkYXRhPiBQcm9kdWNlZCBieSBPbW5pR3JhZmZsZSA3LjE3LjVcbjIwMjAtMTAtMDcgMjE6MDU6MzYgKzAwMDA8L21ldGFkYXRhPgogIDxnIGlkPSJDYW52YXNfMiIgZmlsbD0ibm9uZSIgc3Ryb2tlLW9wYWNpdHk9IjEiIGZpbGwtb3BhY2l0eT0iMSIgc3Ryb2tlPSJub25lIiBzdHJva2UtZGFzaGFycmF5PSJub25lIj4KICAgIDx0aXRsZT5DYW52YXMgMjwvdGl0bGU+CiAgICA8ZyBpZD0iQ2FudmFzXzJfTGF5ZXJfMSI+CiAgICAgIDx0aXRsZT5MYXllciAxPC90aXRsZT4KICAgICAgPGcgaWQ9IkdyYXBoaWNfMTQiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8Y2lyY2xlIGN4PSI3NDIiIGN5PSIxMTA5IiByPSI3NS4wMDAxMTk4NDI2NDIyIiBmaWxsPSIjZmZmZmMwIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iNzQyIiBjeT0iMTEwOSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgc3Ryb2tlPSIjZjBmM2Y2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDY4NyAxMDk5Ljc3NikiIGZpbGw9ImJsYWNrIj4KICAgICAgICAgIDx0c3BhbiBmb250LWZhbWlseT0iSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI0MDAiIGZpbGw9ImJsYWNrIiB4PSI3LjczNiIgeT0iMTUiPnVzZXIvYmlydGhkYXk8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY18xMyIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9IjEwODQuNSIgY3k9IjExMDkiIHI9Ijc1LjAwMDExOTg0MjY0MjEiIGZpbGw9IiNmZmZmYzAiLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxMDg0LjUiIGN5PSIxMTA5IiByPSI3NS4wMDAxMTk4NDI2NDIxIiBzdHJva2U9IiNmMGYzZjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAyOS41IDEwOTkuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjIuNDA4IiB5PSIxNSI+dXNlci9iaXJ0aC15ZWFyPC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkxpbmVfMTIiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8bGluZSB4MT0iODE4IiB5MT0iMTEwOSIgeDI9Ijk4Ni42IiB5Mj0iMTEwOSIgbWFya2VyLWVuZD0idXJsKCNGaWxsZWRBcnJvd19NYXJrZXIpIiBzdHJva2U9ImxpbWUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1Ii8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfMTEiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8cmVjdCB4PSI4NTQuMjk4OCIgeT0iMTA5NC43NzYiIHdpZHRoPSIxMDUuMTIiIGhlaWdodD0iMjguNDQ3OTk4IiBmaWxsPSIjYzBjMGZmIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODU5LjI5ODggMTA5OS43NzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMCIgeT0iMTUiPmJpcnRoZGF5LXllYXI8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY18xMCIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9IjQzOC41IiBjeT0iOTA1IiByPSI3NS4wMDAxMTk4NDI2NDIyIiBmaWxsPSIjZmZmZmMwIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iNDM4LjUiIGN5PSI5MDUiIHI9Ijc1LjAwMDExOTg0MjY0MjIiIHN0cm9rZT0iI2YwZjNmNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzODMuNSA4OTUuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjMwLjQwOCIgeT0iMTUiPnVzZXIvaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iTGluZV85IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGxpbmUgeDE9IjUwMS41ODczNCIgeTE9Ijk0Ny40MDQ3IiB4Mj0iNjYwLjczNyIgeTI9IjEwNTQuMzc4NCIgbWFya2VyLWVuZD0idXJsKCNGaWxsZWRBcnJvd19NYXJrZXIpIiBzdHJva2U9ImxpbWUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1Ii8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfOCIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxyZWN0IHg9IjU0Mi44NDQ4IiB5PSI5ODguNzc3MiIgd2lkdGg9IjgyLjkxMiIgaGVpZ2h0PSIyOC40NDc5OTgiIGZpbGw9IiNjMGMwZmYiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDcuODQ0OCA5OTMuNzc3MikiIGZpbGw9ImJsYWNrIj4KICAgICAgICAgIDx0c3BhbiBmb250LWZhbWlseT0iSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI0MDAiIGZpbGw9ImJsYWNrIiB4PSIxMjc4OTc3ZS0xOSIgeT0iMTUiPnVzZXItYnktaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgICA8ZyBpZD0iR3JhcGhpY183IiBmaWx0ZXI9InVybCgjU2hhZG93KSI+CiAgICAgICAgPGNpcmNsZSBjeD0iNzQyIiBjeT0iNzAxIiByPSI3NS4wMDAxMTk4NDI2NDIyIiBmaWxsPSIjZmZmZmMwIi8+CiAgICAgICAgPGNpcmNsZSBjeD0iNzQyIiBjeT0iNzAxIiByPSI3NS4wMDAxMTk4NDI2NDIyIiBzdHJva2U9IiNmMGYzZjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjg3IDY5MS43NzYpIiBmaWxsPSJibGFjayI+CiAgICAgICAgICA8dHNwYW4gZm9udC1mYW1pbHk9IkhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjE2IiBmb250LXdlaWdodD0iNDAwIiBmaWxsPSJibGFjayIgeD0iMTcuMDY0IiB5PSIxNSI+dXNlci9uYW1lPC90c3Bhbj4KICAgICAgICA8L3RleHQ+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfNiIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxjaXJjbGUgY3g9Ijc0MiIgY3k9IjkwNSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgZmlsbD0iI2ZmZmZjMCIvPgogICAgICAgIDxjaXJjbGUgY3g9Ijc0MiIgY3k9IjkwNSIgcj0iNzUuMDAwMTE5ODQyNjQyMiIgc3Ryb2tlPSIjZjBmM2Y2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDY4NyA4OTUuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjE3Ljk2IiB5PSIxNSI+dXNlci9lbWFpbDwvdHNwYW4+CiAgICAgICAgPC90ZXh0PgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJMaW5lXzUiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8bGluZSB4MT0iNTE0LjUwMDA0IiB5MT0iOTA1IiB4Mj0iNjUzLjEiIHkyPSI5MDUiIG1hcmtlci1lbmQ9InVybCgjRmlsbGVkQXJyb3dfTWFya2VyXzIpIiBzdHJva2U9IndoaXRlIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIvPgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJHcmFwaGljXzQiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8cmVjdCB4PSI1NDMuNzExMiIgeT0iODkwLjc3NiIgd2lkdGg9IjgyLjkxMiIgaGVpZ2h0PSIyOC40NDc5OTgiIGZpbGw9IiNjMGMwZmYiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDguNzExMiA4OTUuNzc2KSIgZmlsbD0iYmxhY2siPgogICAgICAgICAgPHRzcGFuIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9IjQwMCIgZmlsbD0iYmxhY2siIHg9IjEyNzg5NzdlLTE5IiB5PSIxNSI+dXNlci1ieS1pZDwvdHNwYW4+CiAgICAgICAgPC90ZXh0PgogICAgICA8L2c+CiAgICAgIDxnIGlkPSJMaW5lXzMiIGZpbHRlcj0idXJsKCNTaGFkb3cpIj4KICAgICAgICA8bGluZSB4MT0iNTAxLjU4NzMzIiB5MT0iODYyLjU5NTMiIHgyPSI2NjguMjA2NCIgeTI9Ijc1MC42MDA5NSIgbWFya2VyLWVuZD0idXJsKCNGaWxsZWRBcnJvd19NYXJrZXJfMikiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICAgIDwvZz4KICAgICAgPGcgaWQ9IkdyYXBoaWNfMiIgZmlsdGVyPSJ1cmwoI1NoYWRvdykiPgogICAgICAgIDxyZWN0IHg9IjU0Mi44NDQ4IiB5PSI3OTIuNzc0OCIgd2lkdGg9IjgyLjkxMiIgaGVpZ2h0PSIyOC40NDc5OTgiIGZpbGw9IiNjMGMwZmYiLz4KICAgICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDcuODQ0OCA3OTcuNzc0OCkiIGZpbGw9ImJsYWNrIj4KICAgICAgICAgIDx0c3BhbiBmb250LWZhbWlseT0iSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtd2VpZ2h0PSI0MDAiIGZpbGw9ImJsYWNrIiB4PSIxMjc4OTc3ZS0xOSIgeT0iMTUiPnVzZXItYnktaWQ8L3RzcGFuPgogICAgICAgIDwvdGV4dD4KICAgICAgPC9nPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg=="></p></div><p>So resolvers establish edges in the Pathom graph, allowing Pathom to traverse from
some source data to some target data. In the rest of this documentation, you will learn
how to define resolvers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-defresolver"></a>Using <code>defresolver</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-defresolver" title="Direct link to heading">#</a></h2><p>The macro <code>defresolver</code> is the primary way to create new resolvers. It has some sugars
to reduce the boilerplate code related to define a new resolver.</p><p>The main pieces of a resolver are:</p><ul><li><code>::pco/op-name</code> - a symbol that identify the resolver, like a function name.</li><li><code>::pco/output</code> - a EQL expression that informs the attributes <strong>provided</strong> by this resolver.</li><li><code>::pco/input</code> - a EQL expression that informs the attributes <strong>required</strong> by this resolver.</li></ul><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Both input and output can express flat or nested queries, you should always strive to
be as precise with these descriptions as you can (matching the shapes of your inputs and
outputs), Pathom leverages this information in many ways during transaction processing,
and as more accurate you get, the more Pathom can do with it.</p></div></div><p>Let&#x27;s start with a verbose usage of <code>defresolver</code> to go over these main pieces:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; this resolver computes a slug to use on URL from some article title</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [env {:acme.article/keys [title]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/op-name `article-slug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/input   [:acme.article/title]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output  [:acme.article/slug]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Design observation</h5></div><div class="admonition-content"><p>This resolver expresses an edge in Pathom attribute world. It says the attribute <code>:acme.article/slug</code>
is reachable, given that a <code>:acme.article/title</code> is available.</p></div></div><p>If you look close, you can find a fair amount of repetition in this expression:</p><ul><li>The <code>op-name</code> is repeated at the start to define the <code>var</code> name.</li><li>The <code>input</code> is repeated in the destructuring expression.</li><li>The <code>output</code> is visible in the output expression.</li></ul><p>Experience with Pathom 2 demonstrated these repetitions occur frequently in most Pathom
code bases. So Pathom 3 adds some extra sugar tricks to avoid the repetition:</p><ol><li>We can remove the <code>::pco/op-name</code> and let <code>defresolver</code> use the same symbol as the <code>var</code>:</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [env {:acme.article/keys [title]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input  [:acme.article/title]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output [:acme.article/slug]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you use <a href="https://cursive-ide.com/" target="_blank" rel="noopener noreferrer">Cursive</a>, you can ask it to resolve the
<code>pc/defresolver</code> as a <code>defn</code>, and you will get proper symbol resolution</p></div></div><ol start="2"><li>Now, given the <code>input</code> is the same as destructuring, we can let <code>defresolver</code> infer the input from it:</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [env {:acme.article/keys [title]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output [:acme.article/slug]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You can also use destructuring via symbol binding, for example, this works the same:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [env {title :acme.article/title}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output [:acme.article/slug]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div></div></div><ol start="3"><li>Since the last element of our expression is a map, <code>defresolver</code> can infer the <code>output</code> from it:</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; given the map would be empty now, we can remove it completely</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [env {:acme.article/keys [title]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Pathom only looks at the last item of the body for implicit outputs. This means that
if you wrap the map with something like a <code>let</code> statement, Pathom will not be able
to figure it out. Instead, you can move the <code>let</code> down on the attribute level:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver foo []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; infer won&#x27;t work, the last statement is a let</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [x 10]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:foo x}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver foo []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; works</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:foo (let [x 10] x)})</span></div></div></div></div></div><p>In the future, Pathom may get smarter around this, but this is a long rabbit role when
I consider that the last user statement may be an <code>if</code>, <code>cond</code>, etc...</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Although Pathom can infer the configuration, you can always override it using the
options map.</p></div></div><ol start="4"><li>Given we are not using <code>env</code>, we can also take it out, taking us to the final version:</li></ol><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver article-slug [{:acme.article/keys [title]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.article/slug (str/replace title #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>In case you have a resolver that doesn&#x27;t use an input, you can omit the first argument
as well, for example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver constant-pi []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.math/pi 3.1415})</span></div></div></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="invoking-resolvers"></a>Invoking resolvers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invoking-resolvers" title="Direct link to heading">#</a></h2><p>Like functions, you can call the resolvers directly. The arity to call resolver is similar
to how to define resolvers:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver extension [{::keys [path]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::path-ext (last (str/split path #&quot;\.&quot;))})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(extension {::path &quot;foo.txt&quot;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {::path-ext &quot;txt&quot;}</span></div></div></div></div></div><p>This makes it easier to test resolvers in unit tests.</p><p>Outside of the test context, you should have little reason to invoke a resolver directly. What
sets resolvers apart from regular functions are that it contains data about its requirements
and what it provides.</p><p>This allows you to abstract away the operation names and focus only on the attributes.</p><p>To illustrate the difference, let&#x27;s compare the two approaches, first let&#x27;s define the resolvers:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(ns com.wsscode.pathom.docs.resolvers-demos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (:require [clojure.string :as str]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.built-in.resolvers :as pbir]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.indexes :as pci]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.connect.operation :as pco]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [com.wsscode.pathom3.interface.smart-map :as psm]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def user-from-id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pbir/static-table-resolver `user-db :acme.user/id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {1 #:acme.user{:name  &quot;Trey Parker&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   :email &quot;trey@provider.com&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     2 #:acme.user{:name  &quot;Matt Stone&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   :email &quot;matt@provider.com&quot;}}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; avatar slug is a version of email, converting every non letter character into dashes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-avatar-slug [{:acme.user/keys [email]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.user/avatar-slug (str/replace email #&quot;[^a-z0-9A-Z]&quot; &quot;-&quot;)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-avatar-url [{:acme.user/keys [avatar-slug]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:acme.user/avatar-url (str &quot;http://avatar-images-host/for-id/&quot; avatar-slug)})</span></div></div></div></div></div><p>Consider the question: What is the <code>avatar url</code> of the user with id <code>1</code>.</p><p>The traditional way to get there using our resolvers as functions goes as:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(-&gt; {:acme.user/id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (user-from-id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (user-avatar-slug)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (user-avatar-url)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    :acme.user/avatar-url)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; &quot;http://avatar-images-host/for-id/trey-provider-com&quot;</span></div></div></div></div></div><p>Now check a few examples of how we can accomplish the same using the a <a href="/docs/smart-maps">smart map</a>
leveraged by the resolvers meta-data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; first, we build an index for the relations expressed by the resolvers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def indexes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register [user-from-id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 user-avatar-slug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 user-avatar-url]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; now instead of reference the functions, we let Pathom figure them out using the indexes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(-&gt;&gt; {:acme.user/id 2}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (psm/smart-map indexes)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.user/avatar-url)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; &quot;http://avatar-images-host/for-id/matt-provider-com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; to highlight the fact that we disregard the function, other ways where we can change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; the initial data and reach the same result:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(-&gt;&gt; {:acme.user/email &quot;other@provider.com&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (psm/smart-map indexes)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.user/avatar-url)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; &quot;http://avatar-images-host/for-id/other-provider-com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(-&gt;&gt; {:acme.user/avatar-slug &quot;some-slogan&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (psm/smart-map indexes)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     :acme.user/avatar-url)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; &quot;http://avatar-images-host/for-id/some-slogan&quot;</span></div></div></div></div></div><p>Note how as we change the input, Pathom adjusts the resolvers required to call, this
is the main thing that Pathom brings to you, <strong>it removes the chore of knowing the
function names</strong>, so you can focus on the data you have and need, instead of how to
get it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-indexes"></a>Using the indexes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-indexes" title="Direct link to heading">#</a></h3><p>Here we will cover in more detail the process to generate the indexes from resolvers.</p><p>Think of resolvers as the <strong>atomic blocks of Pathom</strong>, which are annotated functions. If Pathom had to scan
every resolver to figure a path, it would be slow. So instead, Pathom works on indexes
generated from a set of resolvers.</p><p>To generate the indexes, we use the function <code>(pci/register ...)</code>. The values allowed
on <code>register</code> are:</p><ul><li>resolvers</li><li>mutations</li><li>indexes</li><li>sequence of previous items (recursively)</li></ul><p>Here are a couple of examples to illustrate:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; create indexes for a single resolver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def single-registry (pci/register some-resolver))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; creating indexes with a few resolvers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def many-registry (pci/register [resolver-a resolver-b]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; define a group of resolvers in a variable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def some-resolvers [res-a res-b])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; now use in combination with other mixes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def more-registry</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register [some-resolvers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 [other-group with-more</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  [deep-nested resolvers]]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 and-more]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; now using indexes as part of registry</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def with-indexes (pci/register [some-resolvers many-registry]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; all together now</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register [[resolver-a resolver-b]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 some-resolvers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 many-registry]))</span></div></div></div></div></div><p>To learn more details about the indexes, check the <a href="/docs/indexes">indexes page</a>.</p><p>With the <code>indexes</code> at hand you can leverage the Pathom engine to call the resolvers for you.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The <code>indexes</code> are part of the Pathom environment, for some operations just the indexes
are enough. When you see <code>indexes</code> or <code>env</code>, consider they expect to have at least
the indexes for the resolvers in the map.</p></div></div><p>For this you may use one of the Pathom 3 interfaces like <a href="/docs/smart-maps">Smart Maps</a> or
<a href="/docs/eql">EQL</a>. Visit those pages if you like to see examples of how to use the Pathom
engine.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="optional-inputs"></a>Optional inputs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#optional-inputs" title="Direct link to heading">#</a></h2><p>You can declare to Pathom that a resolver input is optional. To do so, you can use the
helper <code>pco/?</code> around the attribute.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In practice, this helper adds an EQL param to the keyword, noting it as optional.</p></div></div><p>For this example you can see a resolver that tells how to call the user (for some gretting
message on a site for example). We call this attribute <code>:user/display-name</code>. All users
have emails, but not all users have their names in our database, so to create the
resolver for <code>:user/display-name</code> we make the <code>:user/name</code> attribute optional:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver user-display-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:user/keys [email name]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input [:user/email (pco/? :user/name)]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:user/display-name (or name email)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def opt-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/static-table-resolver :user/id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       {1 {:user/email &quot;user@example.com&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        2 {:user/email &quot;another@example.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           :user/name  &quot;Sam&quot;}})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/constantly-resolver :all-users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       [{:user/id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:user/id 2}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {:user/id 3}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     user-display-name]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process opt-env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:all-users [:user/display-name]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:all-users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;     [{:user/display-name &quot;user@example.com&quot;} ; no name, use email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      {:user/display-name &quot;Sam&quot;} ; has name (the optional), use it</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;      {} ; user 3 doesn&#x27;t exist, so resolver didn&#x27;t get called</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;     ]}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="nested-inputs"></a>Nested inputs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#nested-inputs" title="Direct link to heading">#</a></h2><p>Pathom supports requiring nested inputs on a resolver. This feature is handy when you
need to make data aggregation based on indirect data.</p><p>To illustrate this, consider the following setup:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver top-players</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Return maps with ids for the top players in a given game.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:game/top-players</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [{:player/id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:player/id 20}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:player/id 8}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:player/id 2}]})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver player-by-id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Get player by id, in our case just generate some data based on the id.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:keys [player/id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:player/name (str &quot;Player &quot; id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   :player/score (* id 50)})</span></div></div></div></div></div><p>Now, for the task: how to make a resolver that computes the average score from the top
players?</p><p>If you use the flat inputs as we did before and ask for <code>:game/top-players</code> it will
contain the ids, but not the scores. To make the scores available, a nested processing
is required in this case, and this where nested inputs come to rescue:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver top-players-avg</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Compute the average score for the top players using nested inputs.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:keys [game/top-players]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; we have to make the nested input explicit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input [{:game/top-players [:player/score]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:game/top-players-avg-score</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (let [score-sum (transduce (map :player/score) + 0 top-players)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (double (/ score-sum (count top-players))))})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process (pci/register [top-players player-by-id top-players-avg])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [:game/top-players-avg-score])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; #:game{:top-players-avg-score 387.5}</span></div></div></div></div></div><p>When Pathom is planning, it will verify if a sub-query part reachable. If there is
no available path to fulfill the nested part, the planner will discard that path, avoiding
running unnecessary work on the runner.</p><p>You can try this by asking for a nested property that doesn&#x27;t exist.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="parameters"></a>Parameters<a aria-hidden="true" tabindex="-1" class="hash-link" href="#parameters" title="Direct link to heading">#</a></h2><p>Parameters are a secondary layer to send information to a resolver. One main difference
between params and inputs is that params do not participate in the graph traversal; they
come as-is.</p><p>You can use parameters to allow the user to configure the request for some attribute.</p><p>To illustrate, lets start with a resolver that pulls todo from some mock memory data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def mock-todos-db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{::todo-message &quot;Write demo on params&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ::todo-done?   true}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {::todo-message &quot;Pathom in Rust&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ::todo-done?   false}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver todos-resolver [env _]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; express nested shape</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [{::todos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     [::todo-message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ::todo-done?]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::todos mock-todos-db})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env (pci/register todos-resolver))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; list all todos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pf.eql/process env [::todos])</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>We are using explicit output in the <code>todos-resolver</code> so Pathom has more information about
the structured shape. Although the resolver works without the nested specification, having
it makes it possible for tools to auto-complete better, and this is important when
trying to integrate Pathom indexes, so as a general practice, when resolvers have nested
data, it&#x27;s better always to specify it.</p></div></div><p>To add params to a query attribute, we can use <a href="https://edn-query-language.org/eql/1.0.0/specification.html#_parameters" target="_blank" rel="noopener noreferrer">EQL params</a>,
for example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; list undone todos:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pf.eql/process env [&#x27;(::todos {::todo-done? false})])</span></div></div></div></div></div><p>If we just ran the previous code, nothing happens. To make this work, we need to use
the parameters to filter the data in the resolver code.</p><p>To pull the params we can use the helper <code>(pco/params env)</code>, then filter the list based
on it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def mock-todos-db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{::todo-message &quot;Write demo on params&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ::todo-done?   true}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {::todo-message &quot;Pathom in Rust&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ::todo-done?   false}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver todos-resolver [env _]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [{::todos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     [::todo-message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ::todo-done?]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::todos</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">   ; pull params and filter</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">   (if-some [done? (get (pco/params env) ::todo-done?)]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">     (-&gt;&gt; mock-todos-db</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">          (filter #(= done? (::todo-done? %))))</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">     mock-todos-db)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def env (pci/register todos-resolver))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">; list undone todos</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">(pf.eql/process env</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  &#x27;[(::todos {::todo-done? false})])</span></div></div></div></div></div><p>To use parameters with <a href="/docs/smart-maps">Smart Maps</a> you need to call <code>sm-preload!</code> before
looking up the key, for example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(def sm (psm/smart-map env {}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; preload using EQL params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(psm/sm-preload! sm &#x27;[(::todos {::todo-done? false})])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(::todos sm) ; =&gt; cached filtered li</span></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Example implementation using a more generic function to filter data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn filter-matches [match coll]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [match-keys (keys match)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (if (seq match)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (filter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        #(= match</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (select-keys % match-keys))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        coll)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      coll)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver todos-resolver [env _]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [{::todos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     [::todo-message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ::todo-done?]}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::todos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (filter-matches (pco/params env) mock-todos-db)})</span></div></div></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="batch-resolvers"></a>Batch resolvers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#batch-resolvers" title="Direct link to heading">#</a></h2><p>Batch in Pathom is the process of calling a resolver once with a batch of inputs. So
instead of running the resolver once for each item, it runs the resolver one time with
a sequence of inputs.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Another way to put it: it&#x27;s how Pathom deals with the <a href="https://duckduckgo.com/?q=n%2B1+problem&amp;t=h_&amp;ia=web" target="_blank" rel="noopener noreferrer">N+1 problem</a>.</p></div></div><p>Here is a resolver that simulates a delay, let&#x27;s run in a list and check the time:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver fetch-v [{:keys [id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:v (* 10 id)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(time</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (pci/register fetch-v)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {:list [{:id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {:id 2}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {:id 3}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [{:list [:v]}]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; &quot;Elapsed time: 903.389738 msecs&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:list [{:v 10} {:v 20} {:v 30}]}</span></div></div></div></div></div><p>As we can see, the ~900ms is expected since the resolver ran once for each item.</p><p>Consider a case where some API has a batching feature; in this case, would be ideal
to reduce the number of round trips, you can do it by writing a batch resolver. The main
the difference is that, instead of an input map, you will get a sequence of maps, with all
the inputs collected for batching. Use this to return a list (of the same input size)
and Pathom does the merging in place:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver fetch-v [{:keys [id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:v (* 10 id)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver batch-fetch-v [items]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input  [:id]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output [:v]</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">   ::pco/batch? true}</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  (mapv #(hash-map :v (* 10 (:id %))) items))</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">(time</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  (p.eql/process</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    (pci/register batch-fetch-v)</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    {:list [{:id 1}</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">            {:id 2}</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">            {:id 3}]}</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    [{:list [:v]}]))</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">; &quot;Elapsed time: 302.606045 msecs&quot;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:list [{:v 10} {:v 20} {:v 30}]}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="matching-results"></a>Matching results<a aria-hidden="true" tabindex="-1" class="hash-link" href="#matching-results" title="Direct link to heading">#</a></h3><p>It&#x27;s important that the output sequence of a batch resolver has the size and order as
the input. Sometimes API&#x27;s return things out of order, sometimes it misses items. To
see an example, let&#x27;s shuffle the order of our batch results and see what happens to
the results:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver batch-fetch-v-reorder [items]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input  [:id]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output [:v]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/batch? true}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [results</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (-&gt;&gt; items</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; note we add the id again so the re-order function can match this item with the source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (mapv #(hash-map :id (:id %) :v (* 10 (:id %))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; make the order random</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (shuffle))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    results))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (pci/register batch-fetch-v-reorder)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:list [{:id 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {:id 2}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {:id 3}]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{:list [:id :v]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {:list [{:id 1, :v 20} {:id 2, :v 30} {:id 3, :v 10}]}</span></div></div></div></div></div><p>Another thing that can ruin the matching is if there are missing records, but if that
happens Pathom will trigger an error</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver batch-fetch-v-reorder [items]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input  [:id]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output [:v]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/batch? true}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [results</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (-&gt;&gt; items</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; note we add the id again so the re-order function can match this item with the source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (mapv #(hash-map :id (:id %) :v (* 10 (:id %))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; make the order random</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (shuffle)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; drop some item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (drop 1))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    results))</span></div></div></div></div></div><p>To fix these problems you can use the helper <code>restore-order</code> from
<a href="https://cljdoc.org/d/com.wsscode/cljc-misc/2020.12.01/api/com.wsscode.misc.coll#restore-order" target="_blank" rel="noopener noreferrer">cljc misc</a>:</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the following example we alias <code>[com.wsscode.misc.coll :as coll]</code>.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver batch-fetch-v-reorder-fixed [items]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/input  [:id]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output [:v]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/batch? true}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (Thread/sleep 300)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [results</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (-&gt;&gt; items</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; note we add the id again so the re-order function can match this item with the source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (mapv #(hash-map :id (:id %) :v (* 10 (:id %))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; make the order random</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (shuffle)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             ; drop some item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (drop 1))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (coll/restore-order items :id results)))</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dont-overuse-batch"></a>Don&#x27;t overuse batch<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dont-overuse-batch" title="Direct link to heading">#</a></h3><p>Don&#x27;t batch when the resolver operation is quick. If there is no IO in the
resolver, consider keeping it non-batched.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prioritization"></a>Prioritization<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prioritization" title="Direct link to heading">#</a></h2><p>There are cases where multiple paths are available to get the same data.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="priority-number"></a>Priority number<a aria-hidden="true" tabindex="-1" class="hash-link" href="#priority-number" title="Direct link to heading">#</a></h3><p>You can use the attribute <code>::pco/priority</code> to indicate to Pathom that a resolver is
preferred. The value of <code>::pco/priority</code> is an integer. If not set, the default value
is zero. Negative values are allowed.</p><p>To demonstrate the usage of priority, the following example shows two versions
to get the name, one from cache (preferred), but falling back to the standard db
one when the cache is unable to deliver.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver db-user-by-id [{:user/keys [id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:user/name (str &quot;Name from DB &quot; id)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/defresolver cache-server-user-by-id [{:user/keys [id]}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ; here we increase the priority of the external cache resolver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/priority 1}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {:user/name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (if (even? id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (str &quot;Name from Cache &quot; id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ::pco/unknown-value)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process (pci/register [db-user-by-id cache-server-user-by-id])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{[:user/id 1] [:user/name]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {[:user/id 1] #:user{:name &quot;Name from DB 1&quot;}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(p.eql/process (pci/register [db-user-by-id cache-server-user-by-id])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [{[:user/id 2] [:user/name]}])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; {[:user/id 2] #:user{:name &quot;Name from Cache 2&quot;}}</span></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>You can see that the cached resolver returns <code>::pco/unknown-value</code>. This is equivalent to not having
that key in the response. Doing this way, we can leverage the output inference while expressing this value is unknown, which triggers the next option.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="custom-priority-algorithm"></a>Custom priority algorithm<a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-priority-algorithm" title="Direct link to heading">#</a></h3><p>If you need fine control over prioritization, you can set the key <code>::pcr/choose-path</code>
in the env, to provide your custom function.</p><p>To understand how to make a custom priority function, you must first understand
how the Pathom planner works. Especially the part on <code>OR</code> nodes, <a href="/docs/planner#or-nodes-1">you can find it here</a>.</p><p>This is the default <code>choose-path</code> implementation:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn default-choose-path [env or-node node-ids]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (-&gt; (priority-sort env node-ids)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      first))</span></div></div></div></div></div><p>It takes an environment (which has the graph inside at <code>::pcp/graph</code>), the <code>OR</code> node
in process and a set of <code>node-ids</code>, from which you should pick one.</p><p>Sometimes, the <code>OR</code> node branches could be as simple as two resolvers to choose
from. In other cases, it can be huge, with a complex run graph underneath. So you must
consider this if you are writing a custom prioritization function.</p><p>To illustrate this, let&#x27;s see how Pathom implements <code>priority-sort</code>. The algorithm traverses each of the <code>OR</code> branches to find their leaf nodes for priority sort. This way
we compare the edges (which does what you would expect).</p><p>After comparing the edges, we need to return the original branch node, so we store it as
part of the data.</p><p>Some leaf nodes may be other branch nodes. In those cases, we run the prioritization
again against those nodes, and take the winner to compare also with the parent items.</p><p>To finish up, compare the now generates leaves and take the winner path.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn priority-sort [{::pcp/keys [graph] :as env} node-ids]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        ; start from the node ids</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [nodes-data (-&gt;&gt; node-ids</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        ; map over, navigating to the leaf nodes, and associating back the original id,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        (map #(-&gt; graph</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  (pcp/find-leaf-node (pcp/get-node graph %))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  ; adding the source information to use in the end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  (assoc ::source-node-path %)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        ; this map takes care of expanding branch nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        (map (fn [{::keys [source-node-path] :as node}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                               (if-let [branches (pcp/node-branches node)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 (-&gt; graph</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     (pcp/get-node (first (priority-sort env branches)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                     (assoc ::source-node-path source-node-path))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                 node)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        ; load the config of the reached nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        (keep #(pcp/node-with-resolver-config graph env %)))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ; sort by priority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (mapv ::source-node-path (sort-by #(or (::pco/priority %) 0) #(compare %2 %) nodes-data))))</span></div></div></div></div></div><p>When you override <code>::pcr/choose-path</code>, you can start by copying the <code>default-choose-path</code>
you saw before here, and adjust it for your needs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-resolver"></a>Using <code>resolver</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-resolver" title="Direct link to heading">#</a></h2><p>You can also create a resolver using the <code>resolver</code> helper. This is more useful when
you are making some helper function to generate a resolver.</p><p>To create a resolver using <code>pco/resolver</code> you have the following options:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; using helper syntax</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/resolver `op-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/output [::foo]}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (fn [env input] {::foo &quot;bar&quot;}))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; using config map</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(pco/resolver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {::pco/op-name `op-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/output  [::foo]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ::pco/resolve (fn [env input] {::foo &quot;bar&quot;})})</span></div></div></div></div></div><p>As an example, here are how to generate resolvers to create unit conversion between
meters and foot to a given attribute name:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-clojure codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(defn meter&lt;-&gt;feet-resolver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [attribute]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (let [foot-kw  (keyword (namespace attribute) (str (name attribute) &quot;-ft&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        meter-kw (keyword (namespace attribute) (str (name attribute) &quot;-m&quot;))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [(pbir/single-attr-resolver meter-kw foot-kw #(* % 3.281))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (pbir/single-attr-resolver foot-kw meter-kw #(/ % 3.281))]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(let [sm (psm/smart-map (pci/register (meter&lt;-&gt;feet-resolver :foo)))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [(-&gt; sm (assoc :foo-m 169) :foo-ft)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   (-&gt; sm (assoc :foo-ft 358) :foo-m)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; =&gt; [554.489 109.11307528192624]</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resolver-environment"></a>Resolver environment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resolver-environment" title="Direct link to heading">#</a></h2><p>The environment is a map containing contextual information about the process. You can find
information about environment details at the <a href="/docs/environment">environment page</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/resolvers.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Pathom Tutorial - IP Weather</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/built-in-resolvers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Built-in Resolvers Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-a-resolver-in-pathom" class="table-of-contents__link">What is a resolver in Pathom?</a></li><li><a href="#using-defresolver" class="table-of-contents__link">Using <code>defresolver</code></a></li><li><a href="#invoking-resolvers" class="table-of-contents__link">Invoking resolvers</a><ul><li><a href="#using-the-indexes" class="table-of-contents__link">Using the indexes</a></li></ul></li><li><a href="#optional-inputs" class="table-of-contents__link">Optional inputs</a></li><li><a href="#nested-inputs" class="table-of-contents__link">Nested inputs</a></li><li><a href="#parameters" class="table-of-contents__link">Parameters</a></li><li><a href="#batch-resolvers" class="table-of-contents__link">Batch resolvers</a><ul><li><a href="#matching-results" class="table-of-contents__link">Matching results</a></li><li><a href="#dont-overuse-batch" class="table-of-contents__link">Don&#39;t overuse batch</a></li></ul></li><li><a href="#prioritization" class="table-of-contents__link">Prioritization</a><ul><li><a href="#priority-number" class="table-of-contents__link">Priority number</a></li><li><a href="#custom-priority-algorithm" class="table-of-contents__link">Custom priority algorithm</a></li></ul></li><li><a href="#using-resolver" class="table-of-contents__link">Using <code>resolver</code></a></li><li><a href="#resolver-environment" class="table-of-contents__link">Resolver environment</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Presentations</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/watch?v=IS3i3DTUnAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2019 - The Maximal Graph</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=yyVKf2U8YVg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conj 2018 - Scaling Full Stack Applications</a></li><li class="footer__item"><a href="https://www.youtube.com/watch?v=r3zywlNflJI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dutch Clojure Days 2018 - Clojure Graph APIâ€™s</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://clojurians.slack.com/messages/pathom/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Wilker Lucio</div></div></div></footer></div>
<script src="/styles.bef5ab94.js"></script>
<script src="/runtime~main.3f4d5e33.js"></script>
<script src="/main.247d77bb.js"></script>
<script src="/1.0c39851d.js"></script>
<script src="/2.355056da.js"></script>
<script src="/3.3cf39f4a.js"></script>
<script src="/1be78505.b7b1ed05.js"></script>
<script src="/38.e3a94f3c.js"></script>
<script src="/935f2afb.0045dded.js"></script>
<script src="/17896441.6b25e3fd.js"></script>
<script src="/c9b331de.a7b258c4.js"></script>
</body>
</html>