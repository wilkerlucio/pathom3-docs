(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{107:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),l=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=l(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=l(n),u=a,d=m["".concat(o,".").concat(u)]||m[u]||b[u]||i;return n?r.a.createElement(d,s(s({ref:t},p),{},{components:n})):r.a.createElement(d,s({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},338:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/autocomplete-ebfe4f0a58b57a1fea4814292a38a1ae.png"},339:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/query-803f5c9022f5b16e50d8b9dcff9787e2.png"},90:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return l}));var a=n(2),r=n(6),i=(n(0),n(107)),o={id:"graphql-integration",title:"GraphQL Integration"},s={unversionedId:"tutorials/graphql-integration",id:"tutorials/graphql-integration",isDocsHomePage:!1,title:"GraphQL Integration",description:"This tutorial will demonstrate how you can consume GraphQL services in Pathom, making",source:"@site/docs/tutorials/graphql-integration.mdx",slug:"/tutorials/graphql-integration",permalink:"/docs/tutorials/graphql-integration",editUrl:"https://github.com/wilkerlucio/pathom3-docs/edit/master/docs/tutorials/graphql-integration.mdx",version:"current",sidebar:"docs",previous:{title:"Scripting with Babashka",permalink:"/docs/tutorials/babashka"}},c=[{value:"Star Wars API",id:"star-wars-api",children:[]},{value:"Federating over multiple GraphQL services",id:"federating-over-multiple-graphql-services",children:[]}],p={rightToc:c};function l(e){var t=e.components,o=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,o,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This tutorial will demonstrate how you can consume GraphQL services in Pathom, making\nit part of the attribute system."),Object(i.b)("h2",{id:"star-wars-api"},"Star Wars API"),Object(i.b)("p",null,"To demonstrate this integration we are going to use the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://swapi-graphql.netlify.app/"}),"Star Wars GraphQL API")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clojure"}),'(ns com.wsscode.pathom3.docs.demos.tutorials.graphql\n  (:require\n    [clojure.data.json :as json]\n    [com.wsscode.pathom3.graphql :as p.gql]\n    [com.wsscode.pathom3.interface.eql :as p.eql]\n    [org.httpkit.client :as http]))\n\n; first a helper function to request GraphQL queries to the Star Wars API\n(defn request-swapi-graphql [query]\n  (-> @(http/request\n         {:url     "https://swapi-graphql.netlify.app/.netlify/functions/index"\n          :method  :post\n          :headers {"Content-Type" "application/json"\n                    "Accept"       "*/*"}\n          :body    (json/write-str {:query query})})\n      :body\n      json/read-str))\n\n; lets create the environment\n(def env\n  (-> {}\n      ; this helper will pull the schema and register it in the environment\n      (p.gql/connect-graphql\n        {::p.gql/namespace "swapi"}\n        request-swapi-graphql)))\n\n(comment\n  ; request all people and the title of the films they participate\n  (p.eql/process\n    env\n    [{:swapi.Root/allPeople\n      [{:swapi.PeopleConnection/people\n        [:swapi.Person/name\n         {:swapi.Person/filmConnection\n          [{:swapi.PersonFilmsConnection/films\n            [:swapi.Film/title]}]}]}]}]))\n')),Object(i.b)("h2",{id:"federating-over-multiple-graphql-services"},"Federating over multiple GraphQL services"),Object(i.b)("p",null,"In this part we will see how we can use Pathom to connect data leveraging multiple\nGraphQL services."),Object(i.b)("p",null,"In this example we are going to use the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://tmdb.apps.quintero.io/"}),"TMDB")," which is an open GraphQL service for\nmovie data."),Object(i.b)("p",null,"Although the SWAPI has some data about the movies, the TMDB has more data, like overview,\nimages, budget..."),Object(i.b)("p",null,"So how can we leverage this data to augment the information we have from the SWAPI?"),Object(i.b)("p",null,"The first thing we need is a way to associate the SWAPI video instance, with a Movie\nentry on TMDB."),Object(i.b)("p",null,"For this example I'll use a simple table mapping, that maps ids from SWAPI to TMDB."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clojure"}),'(def swapi-id->tmdb-id\n  {"ZmlsbXM6MQ==" "MDoxMQ=="\n   "ZmlsbXM6Mg==" "MDoxODkx"\n   "ZmlsbXM6Mw==" "MDoxODky"\n   "ZmlsbXM6NA==" "MDoxODkz"\n   "ZmlsbXM6NQ==" "MDoxODk0"\n   "ZmlsbXM6Ng==" "MDoxODk1"})\n')),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"I got the TMDB id's by manually searching for the Star Wars movies there. You could\nas an exercise try to make this more automatic, maybe by using the movie number or\nname to search from TMDB."))),Object(i.b)("p",null,"Now let's include the TMDB setup in our environment and integrate the mapping:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clojure"}),'; refactor to simplify the definition of a graphql source\n(defn graphql-request [url query]\n  (-> @(http/request\n         {:url     url\n          :method  :post\n          :headers {"Content-Type" "application/json"\n                    "Accept"       "*/*"}\n          :body    (json/write-str {:query query})})\n      :body\n      json/read-str))\n\n; SWAPI request\n(def request-swapi\n  #(graphql-request "https://swapi-graphql.netlify.app/.netlify/functions/index" %))\n\n; TMDB request\n(def request-tmdb\n  #(graphql-request "https://tmdb.apps.quintero.io/" %))\n\n(def swapi-id->tmdb-id\n  {"ZmlsbXM6MQ==" "MDoxMQ=="\n   "ZmlsbXM6Mg==" "MDoxODkx"\n   "ZmlsbXM6Mw==" "MDoxODky"\n   "ZmlsbXM6NA==" "MDoxODkz"\n   "ZmlsbXM6NQ==" "MDoxODk0"\n   "ZmlsbXM6Ng==" "MDoxODk1"})\n\n(def env\n  (-> {}\n      (pci/register\n        ; apply the static mapping using a built-in resolver helper\n        [(pbir/static-attribute-map-resolver :swapi.Film/id :tmdb.Node/id\n           swapi-id->tmdb-id)])\n      (p.gql/connect-graphql\n        {::p.gql/namespace "swapi"}\n        request-swapi)\n      (p.gql/connect-graphql\n        {::p.gql/namespace "tmdb"\n         ::p.gql/ident-map {"node" {"id" ["Node" "id"]}}}\n        request-tmdb)\n      ; let\'s integrate pathom viz so we can explore our data, note you need to add the\n      ; pathom connector dependency to your project https://github.com/wilkerlucio/pathom-viz-connector\n      ((requiring-resolve \'com.wsscode.pathom.viz.ws-connector.pathom3/connect-env)\n       "gqldemo")))\n')),Object(i.b)("p",null,"Using Pathom Viz, we can use the auto-complete to explore our new possibilities:"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Integrated options",src:n(338).default})),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The reason we see other types like ",Object(i.b)("inlineCode",{parentName:"p"},"TVShow")," is due to the fact the entry point for an\nentity in TMDB is a generic type called ",Object(i.b)("inlineCode",{parentName:"p"},"Node"),", which means any type that implements\nthis interface might be a valid option here, and in this case Pathom will offer all the possible\noptions."),Object(i.b)("p",{parentName:"div"},"Pathom will automatically group the attributes when sending to GraphQL using the\n",Object(i.b)("inlineCode",{parentName:"p"},"... on TYPE { attr attr2 } ")," syntax, and since in Pathom we have the full type name on\neach attribute that grouping is based on looking at the last namespace part in the\nattribute name."))),Object(i.b)("p",null,"An example query getting the title from SWAPI, while overview and budget from TMDB:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clojure"}),"[{:swapi.Root/allFilms\n  [{:swapi.FilmsConnection/films\n    [:swapi.Film/title\n     :tmdb.Movie/budget\n     :tmdb.Movie/overview]}]}]\n")),Object(i.b)("p",null,Object(i.b)("img",{alt:"Integrated query",src:n(339).default})),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"In this scenario we see an N+1 issue. In the future this should be optimized internally\nand the same process should be resolved with just one request for each GraphQL\nservice."),Object(i.b)("p",{parentName:"div"},"You can track this at: ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/wilkerlucio/pathom3-graphql/issues/11"}),"https://github.com/wilkerlucio/pathom3-graphql/issues/11")))))}l.isMDXComponent=!0}}]);